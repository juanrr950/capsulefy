{% extends 'base.html' %}
{% load static %}
{% block contenido %}
<div class="container main-capsule">
    <h3> {{ capsule.title }} 
        <blockquote class="blockquote">
            <p class="blockquote-footer">Written by <cite title="Source Title">{{ capsule.creator.username }}</cite></p>
        </blockquote>
    </h3>

    {% if user.id == capsule.creator.id %}
    <div class="module-btn-top">
            {% if capsule.capsule_type == "F" and editable %}
                <button class="btn btn-primary" onclick="window.location='/editfreecapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            {% if capsule.capsule_type == "P" and editable%}
                <button class="btn btn-primary" onclick="window.location='/editpremiumcapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            {% if capsule.capsule_type == "M" and editable%}
                <button class="btn btn-primary" onclick="window.location='/editmodularcapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            <button class="btn btn-danger" onclick="window.location='/deletecapsule/{{capsule.id}}'">Delete capsule</button>
            {% if capsule.dead_man_switch and editable%}
                <button class="btn btn-warning" onclick="window.location='refresh'">Refresh capsule</button>
            {% endif %}
    </div>
    {% endif %}


    {% for module in modules %}
        <div class="card">
            <div class="card-header">
            {% if forloop.counter0 == 0 %}
                    Capsule
                {% else %}
                    Module {{ forloop.counter0 }}
                {% endif %}
            </div>
            <div class="card-body">
                <h4 class="description">{{ module.description }}</h4><br>
                {% if module.files %}
                <div class="container">
                <div class="row">
                    {% for file in module.files.all %}
                        <div class="col-sm-12 col-md-5 elem-display">
                            {% if file.type == "I" %}
                                <img class="img-fluid rounded" src="{{ file.url }}"/>
                            {% endif %}
                            {% if file.type == "F" %}
                                <div class="button_div">
                                    <button type="button" class="btn btn-primary" onclick="window.location='{{file.url}}'">{{file.local_name}}</button>
                                </div>
                            {% endif %}
                            {% if file.type == "V" %}
                                <div class="embed-responsive embed-responsive-4by3">
                                    <video class="embed-responsive-item" controls preload="none" src="{{file.url}}"></video>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-1"> </div>
                    {% endfor %}
                </div>
                </div>
                {% endif %}
            </div>
        </div>
        <br>
    {% endfor %}


    {% if user.id == capsule.creator.id %}
    <div class="module-btn-bottom">
            {% if capsule.capsule_type == "F" and editable %}
                <button class="btn btn-primary" onclick="window.location='/editfreecapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            {% if capsule.capsule_type == "P" and editable %}
                <button class="btn btn-primary" onclick="window.location='/editpremiumcapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            {% if capsule.capsule_type == "M" and editable %}
                <button class="btn btn-primary" onclick="window.location='/editmodularcapsule/{{capsule.id}}'">Edit capsule</button>
            {% endif %}
            <button class="btn btn-danger" onclick="window.location='/deletecapsule/{{capsule.id}}'">Delete capsule</button>
            {% if capsule.dead_man_switch and editable %}
                <button class="btn btn-warning" onclick="window.location='refresh'">Refresh capsule</button>
            {% endif %}
    </div>
    {% endif %}

</div>
{% endblock %}
{% block styles %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/styleDisplay.css' %}"/>
{% endblock %}